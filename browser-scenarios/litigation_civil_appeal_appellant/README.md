# 民事上诉场景 - 上诉人（一审败诉）

## 场景概述

本场景模拟民事诉讼中一审败诉后，作为上诉人提起上诉的完整流程。用户需要提供一审判决书、上诉理由、相关证据等材料，系统将协助生成上诉状等法律文书。

## 场景特点

- **角色定位**：上诉人（一审原告，一审败诉）
- **案件类型**：民间借贷纠纷
- **核心诉求**：撤销一审判决，改判支持诉讼请求
- **主要产物**：上诉状

## 测试路径

### 1. progressive.yaml - 渐进式对话（6轮交互）

适用于信息不完整的场景，需要逐步补充信息。

**交互流程**：
1. R1: 初始上诉案情输入 + 上传一审判决书 → clarify 卡片（补充身份信息）
2. R2: 补充上诉人身份信息 → select 卡片（案由确认）
3. R3: 确认案由 → select 卡片（上诉理由选择）
4. R4: 选择上诉理由 → select 卡片（文书选择）
5. R5: 选择文书类型 → confirm 卡片（文书审核）
6. R6: 确认上诉状 → 完成

### 2. one_shot.yaml - 一次性完整输入（5轮交互）

适用于信息完整的场景，跳过 clarify 卡片。

**交互流程**：
1. R1: 完整上诉信息输入（含身份证号） → select 卡片（案由确认）
2. R2: 确认案由 → select 卡片（上诉理由选择）
3. R3: 选择上诉理由 → select 卡片（文书选择）
4. R4: 选择文书类型 → confirm 卡片（文书审核）
5. R5: 确认上诉状 → 完成

### 3. rollback.yaml - 回退补充场景（8轮交互）

模拟在文书审核阶段发现问题，触发回退补充上诉理由的场景。

**交互流程**：
1. R1-R4: 同 progressive 路径
2. R5: 选择文书类型 → confirm 卡片
3. R6: 审核文书发现问题 → clarify 卡片（补充上诉理由）
4. R7: 补充上诉理由 → confirm 卡片（重新生成文书）
5. R8: 确认修改后的上诉状 → 完成

## 测试数据

### 当事人信息

- **上诉人**：张三E2E01
  - 身份证号：110101199001011234
  - 一审角色：原告
  
- **被上诉人**：李四E2E01
  - 身份证号：110101199002022345
  - 一审角色：被告

### 案件信息

- **案由**：民间借贷纠纷
- **一审案号**：（2023）京0101民初12345号
- **借款金额**：100000元
- **借款日期**：2023年1月1日
- **约定还款日期**：2023年12月31日
- **一审判决日期**：2023年10月15日
- **一审判决结果**：驳回原告诉讼请求

### 上诉理由

1. **一审认定事实错误**
   - 借款关系认定错误
   - 借条真实性认定错误
   - 转账性质认定错误

2. **一审适用法律错误**
   - 举证责任分配错误
   - 证据采信规则适用错误
   - 法律适用不当

### 证据材料

- `first_instance_judgment.txt` - 一审判决书
- `appeal_grounds.txt` - 上诉理由详细说明
- `new_evidence.txt` - 新证据材料（微信聊天记录、证人证言等）
- `additional_materials.txt` - 补充材料（法律分析、类似案例等）

## 涉及的技能

1. **litigation-intake** - 诉讼信息采集
2. **cause-recommendation** - 案由推荐
3. **documents** - 文书选择
4. **document-generation** - 文书生成

## 预期产物

- **上诉状**（appeal_brief.docx）
  - 包含上诉人、被上诉人基本信息
  - 一审判决基本情况
  - 上诉请求
  - 事实与理由
  - 证据清单
  - 法律依据

## 验证要点

1. **信息完整性**
   - 上诉人、被上诉人信息准确
   - 一审判决信息完整
   - 上诉理由清晰明确

2. **法律准确性**
   - 上诉理由符合法律规定
   - 法律依据引用正确
   - 诉讼请求合法合理

3. **文书规范性**
   - 格式符合法律文书要求
   - 语言表达专业规范
   - 逻辑结构清晰

## 配置说明

- **base_url**: http://localhost:5175
- **timeout**: 180000ms（3分钟）
- **screenshot_on_failure**: true

## 运行方式

```bash
pytest tests/test_browser_scenarios.py::test_litigation_civil_appeal_appellant_progressive -v
pytest tests/test_browser_scenarios.py::test_litigation_civil_appeal_appellant_one_shot -v
pytest tests/test_browser_scenarios.py::test_litigation_civil_appeal_appellant_rollback -v
```

## 注意事项

1. 确保系统已正确配置 LLM API
2. 确保知识库包含民间借贷相关法律法规
3. 确保文书模板已正确配置
4. 测试前检查所有证据文件是否存在
5. 上诉期限为一审判决送达之日起15日内

## 相关文档

- [E2E测试框架说明](../../README.md)
- [浏览器场景测试规范](../../docs/browser-scenarios.md)
- [民事诉讼流程说明](../../docs/civil-litigation.md)
