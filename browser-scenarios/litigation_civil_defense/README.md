# 民事应诉场景测试

## 场景概述

本场景模拟民间借贷纠纷的被告应诉流程，测试系统在民事应诉场景下的完整对话流程和文书生成能力。

## 案件背景

- **案由**：民间借贷纠纷
- **原告**：王五E2E01（身份证：110101199004044567）
- **被告**：赵六E2E01（身份证：110101199003033456）
- **争议焦点**：
  - 原告主张借款金额为100000元
  - 被告辩称实际借款金额为80000元，已还款50000元，剩余30000元
- **应诉策略**：部分抗辩
- **目标产物**：答辩状（defense_statement.docx）

## 测试路径

### 1. progressive.yaml - 渐进式对话（6轮）

逐步补充信息的标准流程：

1. **R1**: 初始案情输入 + 上传证据 → clarify 卡片（补充身份信息）
2. **R2**: 补充当事人身份证号 → select 卡片（案由确认）
3. **R3**: 确认案由（民间借贷） → select 卡片（应诉策略选择）
4. **R4**: 选择应诉策略（部分抗辩） → select 卡片（文书类型选择）
5. **R5**: 选择文书类型（答辩状） → confirm 卡片（文书审核）
6. **R6**: 确认文书 → 完成，生成答辩状

### 2. one_shot.yaml - 一次性完整输入（5轮）

提供完整信息，跳过 clarify 环节：

1. **R1**: 完整信息输入（含身份证号、应诉策略） + 上传证据 → select 卡片（案由确认）
2. **R2**: 确认案由 → select 卡片（应诉策略选择）
3. **R3**: 选择应诉策略 → select 卡片（文书类型选择）
4. **R4**: 选择文书类型 → confirm 卡片（文书审核）
5. **R5**: 确认文书 → 完成，生成答辩状

### 3. rollback.yaml - 回退补充证据（8轮）

在文书确认环节发现证据不足，触发回退：

1. **R1-R4**: 同 progressive 前4轮
2. **R5**: 选择文书类型 → confirm 卡片（文书审核）
3. **R6**: 发现证据不足，拒绝确认 → clarify 卡片（补充证据）
4. **R7**: 补充银行流水和转账凭证 → confirm 卡片（重新审核）
5. **R8**: 确认文书 → 完成，生成答辩状

## 测试数据

### 证据文件

- `complaint.txt` - 原告起诉状（主张借款100000元）
- `loan_contract.txt` - 借款合同（实际借款80000元）
- `repayment_record.txt` - 还款记录（已还款50000元）
- `additional_evidence.txt` - 补充证据（银行流水、转账凭证、证人证言）

### 关键信息

- 原告主张：借款100000元，全部未还
- 被告辩称：借款80000元，已还50000元，剩余30000元
- 证据支持：借款合同、还款记录、银行流水
- 应诉策略：部分抗辩（承认部分债务，否认全部债务）

## 技能调用链

1. **litigation-intake** - 案件信息采集
2. **cause-recommendation** - 案由推荐
3. **litigation-intake** - 应诉策略选择
4. **documents** - 文书类型选择
5. **document-generation** - 文书生成

## 预期产物

- 答辩状（defense_statement.docx）
- 包含以下内容：
  - 被告基本信息
  - 答辩意见（部分抗辩）
  - 事实与理由
  - 证据清单
  - 诉讼请求

## 验证要点

1. 系统能正确识别民事应诉场景
2. 能准确提取原告起诉状中的关键信息
3. 能根据被告提供的证据进行抗辩分析
4. 生成的答辩状逻辑清晰，论证充分
5. 证据补充流程能正常触发和完成
6. 最终产物符合法律文书规范

## 运行方式

```bash
pytest tests/test_browser_scenarios.py::test_litigation_civil_defense_progressive -v
pytest tests/test_browser_scenarios.py::test_litigation_civil_defense_one_shot -v
pytest tests/test_browser_scenarios.py::test_litigation_civil_defense_rollback -v
```

## 注意事项

1. 本场景需要真实的 LLM 环境，不使用 mock
2. 测试数据中的身份证号、银行账号等均为虚构
3. 应诉策略选择会影响答辩状的生成内容
4. 证据补充环节测试系统的回退和重新生成能力
