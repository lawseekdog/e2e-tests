id: progressive
name: 渐进式对话
description: 信息不完整，通过多轮对话逐步补充。适用于用户初次描述简单的场景。

interactions:
  - id: round_1
    name: 上传营业执照并简单描述
    user_action:
      type: upload_file
      attachments:
        - "{{ assets.business_license }}"
      message: |
        请帮我对这家公司进行尽职调查。
    
    ai_response:
      sse_events:
        - event: skill_start
          expect:
            skill_id: "due-diligence-intake"
        - event: delta
          expect:
            contains: ["尽职调查", "公司"]
        - event: card
          expect:
            review_type: "clarify"
            questions_count: ">= 1"
        - event: end
          expect:
            reason: "card"
      
      final_state:
        type: card
        card:
          review_type: "clarify"
          skill_id: "due-diligence-intake"
          questions:
            - field_key: "profile.due_diligence_scope"
              input_type: "textarea"
              required: true
            - field_key: "data.non_litigation.intake_stop_ask"
              input_type: "boolean"
              required: true
      
      thinking:
        must_include: ["尽职调查", "公司"]
        must_not_include: ["错误", "失败"]

  - id: round_2
    name: 补充尽调范围
    user_action:
      type: resume_card
      card_answers:
        - field_key: "profile.due_diligence_scope"
          value: |
            请重点关注：
            1. 公司基本情况和股权结构
            2. 财务状况和经营风险
            3. 重大合同和法律纠纷
            4. 合规性问题
        - field_key: "data.non_litigation.intake_stop_ask"
          value: false
    
    ai_response:
      sse_events:
        - event: skill_start
          expect:
            skill_id: "due-diligence-analysis"
        - event: delta
          expect:
            contains: ["分析", "风险"]
        - event: tool_start
          expect:
            tool_name: "knowledge.search"
        - event: tool_end
          expect:
            success: true
        - event: end
          expect:
            reason: "stop"
      
      final_state:
        type: message
        message:
          contains: ["公司", "财务", "风险", "合规"]
          not_contains: ["错误", "失败"]
          length: ">= 500"
      
      thinking:
        must_include: ["尽职调查", "风险", "分析"]
        must_not_include: ["错误", "失败"]

  - id: round_3
    name: 请求生成尽调报告
    user_action:
      type: chat
      message: "请生成尽职调查报告"
    
    ai_response:
      sse_events:
        - event: skill_start
          expect:
            skill_id: "documents"
        - event: delta
          expect:
            contains: ["报告", "文书"]
        - event: card
          expect:
            review_type: "select"
        - event: end
          expect:
            reason: "card"
      
      final_state:
        type: card
        card:
          review_type: "select"
          skill_id: "documents"
          questions:
            - field_key: "profile.decisions.selected_documents"
              input_type: "multi_select"
              required: true

  - id: round_4
    name: 选择报告类型
    user_action:
      type: resume_card
      card_answers:
        - field_key: "profile.decisions.selected_documents"
          value: ["due_diligence_report"]
    
    ai_response:
      sse_events:
        - event: skill_start
          expect:
            skill_id: "document-generation"
        - event: tool_start
          expect:
            tool_name: "template__render_batch_to_files"
        - event: tool_end
          expect:
            success: true
            result:
              has_file_id: true
        - event: card
          expect:
            review_type: "confirm"
        - event: end
          expect:
            reason: "card"
      
      final_state:
        type: card
        card:
          review_type: "confirm"
          skill_id: "document-generation"
          questions:
            - field_key: "profile.decisions.document_reviewed"
              input_type: "document_review"
              required: true

  - id: round_5
    name: 确认报告
    user_action:
      type: resume_card
      card_answers:
        - field_key: "profile.decisions.document_reviewed"
          value: true
    
    ai_response:
      sse_events:
        - event: delta
          expect:
            contains: ["报告", "生成", "完成"]
        - event: end
          expect:
            reason: "stop"
      
      final_state:
        type: message
        message:
          contains: ["报告", "生成", "下载"]
          length: ">= 100"
        deliverable:
          output_key: "due_diligence_report"
          file_type: "docx"
